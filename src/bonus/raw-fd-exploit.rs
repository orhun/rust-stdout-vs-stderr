#!/usr/bin/env rust-script

use std::{
    fs::File,
    io::{Read, Result},
    mem,
    os::unix::io::{AsRawFd, FromRawFd},
};

fn read_metadata(file: &File) -> Result<()> {
    let fd = file.as_raw_fd();
    unsafe {
        let _ = File::from_raw_fd(fd);
    }
    mem::forget(File::open("src/main.rs")?);
    Ok(())
}

fn main() -> Result<()> {
    let mut file = File::open("Cargo.toml")?;

    read_metadata(&file)?;

    println!("Contents of Cargo.toml:\n{}", {
        let mut s = String::new();
        file.read_to_string(&mut s)?;
        s
    });
    Ok(())
}
